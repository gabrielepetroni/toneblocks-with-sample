<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Thesis</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <link rel='stylesheet' type='text/css' media='screen' href='style.css'> -->

    <!-- include core Blockly script and blocks -->
    <script src="google-blockly-ba6dfd8/blockly_compressed.js"></script>
    <script src="google-blockly-ba6dfd8/javascript_compressed.js"></script>
    <script src="google-blockly-ba6dfd8/blocks_compressed.js"></script>
    <script src="google-blockly-ba6dfd8/msg/js/en.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>THESIS</h1>

    <!-- empty div for Blockly injection -->
    <div id="blocklyDiv" style="height: 500px; width: 600px"></div>

    <!-- toolbox -->
    <xml id="toolbox" style="display: none">
        <block type="controls_if"></block>
        <block type="controls_repeat_ext"></block>
        <block type="logic_compare"></block>
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
        <block type="text"></block>
        <block type="text_print"></block>
    </xml>

    <div id="textarea"></div>
    <div id="controls">
        <button id="runbutton">Run Script</button>
    </div>
    <script>
        // inject Blockly into the blocklyDiv
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox')
        });

        // convert workspace to text code
        function updateTextArea(event) {
            let code = Blockly.JavaScript.workspaceToCode(workspace);
            document.getElementById('textarea').innerText = code;
        }
        workspace.addChangeListener(updateTextArea);

        function runCode() {
            // Generate JavaScript code and run it.
            window.LoopTrap = 1000;
            Blockly.JavaScript.INFINITE_LOOP_TRAP =
                'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
            let code = Blockly.JavaScript.workspaceToCode(workspace);
            Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
            try {
                eval(code);
            } catch (e) {
                alert(e);
            }
        }

        const runButton = document.getElementById('runbutton');
        runButton.addEventListener('click', runCode);
    </script>
</body>

</html>