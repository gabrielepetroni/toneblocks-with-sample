<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sequencer</title>
    <script src="node_modules/tone/build/Tone.js"></script>
    
</head>
<body>
    <button id="start">Start Audio</button>
    <button id="stop">Stop Audio</button>
    <input id="tempo" type="range" min="20" max="120" value="40" class="slider">
    <tone-slider-pad></tone-slider-pad>

    <script>
        const start = document.getElementById('start');
        const tempo = document.getElementById('tempo');

        tempo.addEventListener('change', () => {
            Tone.Transport.bpm.value = tempo.value;
        });

        start.addEventListener('click', async () => {
            await Tone.start();
            Tone.Transport.start();
            Tone.Transport.bpm.value = tempo.value;
        });

        let notes = [];
        let subnotes = [];
        for (let i = 0; i < 5; i++) {
            for (let j = 0; j < ((Math.random() * 4) + 1); j++) {
                subnotes[j] = Tone.Frequency((60 + ((Math.random()*50) + 1)), 'midi');
            }
            notes[i] = [...subnotes];
            subnotes = [];
        }

        const synth = new Tone.Synth().toDestination();
        const seq = new Tone.Sequence((time, note) => {
            synth.triggerAttackRelease(note, 0.001, time);
        }, [...notes]).start(0);
        
        const kickGain = new Tone.Gain().toDestination();
        kickGain.gain.value = 0.7;
        const kick = new Tone.MembraneSynth().connect(kickGain);
        const kickPart = new Tone.Loop((time) => {
            kick.triggerAttackRelease('C2', '4n', time);

        }).start(0);

        const hatGain = new Tone.Gain().toDestination();
        hatGain.gain.value = 0.3;
        const hat = new Tone.NoiseSynth().connect(hatGain);
        const hatPart = new Tone.Sequence((time, note) => {
            hat.triggerAttackRelease(note, time);
        }, [['8n', '8n'],['8n', '8n']]).start(0);

        const reverb = new Tone.Reverb().toDestination();
        reverb.decay = 0.5;
        reverb.preDelay = 0.3;

        const snNz = new Tone.NoiseSynth().connect(reverb);
        const snare = new Tone.MembraneSynth().connect(reverb);
        const snarePart = new Tone.Loop((time) => {
            snare.triggerAttackRelease('G3', '4n', time);
            snNz.triggerAttackRelease('8n', time);

        }).start('8n');

        const stop = document.getElementById('stop');
        stop.addEventListener('click', () => {
            Tone.Transport.stop();
        });
    </script>
</body>
</html>